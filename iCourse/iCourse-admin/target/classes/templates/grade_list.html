<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>班级管理</title>
    <link rel="stylesheet" th:href="@{/Sys/css/layui.css}">
    <script th:src="@{/Sys/lib/layui/layui.js}"></script>
    <script th:src="@{/Sys/js/jquery-3.3.1.min.js}"></script>
</head>
<body>
<div class="x-body">
    <!-- 操作按钮区 -->
    <div class="x-block">
        <button class="layui-btn" onclick="addGrade()"><i class="layui-icon"></i>添加班级</button>
    </div>

    <!-- 班级表格 -->
    <table id="gradeTable" lay-filter="gradeTable"></table>
</div>

<!-- 操作列模板（编辑/删除按钮） -->
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script>
    layui.use('table', function(){
        var table = layui.table;
        var layer = layui.layer;

        // 渲染表格
        table.render({
            elem: '#gradeTable'
            ,url: '/course/grade/list'  // 后端分页接口
            ,page: true  // 开启分页
            ,cols: [[
                {field: 'id', title: 'ID', width: 80, sort: true}
                ,{field: 'name', title: '班级名称', width: 150}
                ,{field: 'major', title: '专业', width: 120}
                ,{field: 'department', title: '系部', width: 180}
                ,{field: 'college', title: '学院', width: 200}
                ,{field: 'monitor', title: '班长', width: 100}
                ,{field: 'learningCommittee', title: '学习委员', width: 120}
                ,{title: '操作', toolbar: '#barDemo', width: 160}  // 绑定操作列模板
            ]]
        });

        // 监听表格操作（编辑/删除）
        table.on('tool(gradeTable)', function(obj){
            var data = obj.data;  // 当前行数据
            if(obj.event === 'del'){
                // 删除确认
                layer.confirm('确定删除【'+data.name+'】吗？', function(index){
                    $.post("/course/grade/delete", {id: data.id}, function(res){
                        if(res === 'success'){
                            obj.del();  // 移除表格行
                            layer.close(index);
                            layer.msg('删除成功', {icon: 1});
                        } else {
                            layer.msg('删除失败', {icon: 2});
                        }
                    });
                });
            } else if(obj.event === 'edit'){
                // 跳转编辑页面
                layer.open({
                    type: 2,
                    title: '编辑班级',
                    area: ['600px', '450px'],
                    content: '/course/grade/toGradeEdit?id='+data.id  // 携带班级ID
                });
            }
        });
    });

    // 跳转新增班级页面
    function addGrade(){
        layer.open({
            type: 2,
            title: '添加班级',
            area: ['600px', '450px'],
            content: '/course/grade/toGradeAdd'
        });
    }
</script>
</body>
</html>